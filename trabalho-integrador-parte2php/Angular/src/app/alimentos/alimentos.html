<!-- Container principal que envolve toda a aplicaÃ§Ã£o -->
<div class="container">
  
  <!-- CabeÃ§alho com tÃ­tulo e descriÃ§Ã£o do sistema -->
  <header class="header">
    <!-- TÃ­tulo principal com emoji de planta -->
    <h1 class="titulo-principal">ğŸŒ± Sistema de Gerenciamento da Horta do IF</h1>
    <!-- SubtÃ­tulo explicativo -->
    <p class="subtitulo">
      Gerencie e visualize os alimentos cultivados na horta
    </p>
  </header>

  <!-- SeÃ§Ã£o de loading - sÃ³ aparece quando carregando=true -->
  <div *ngIf="carregando" class="loading">
    <!-- Spinner animado de carregamento -->
    <div class="spinner"></div>
    <p>Carregando dados da horta...</p>
  </div>

  <!-- SeÃ§Ã£o de erro - sÃ³ aparece quando hÃ¡ mensagem de erro -->
  <div *ngIf="erro" class="erro">
    <h3>âš ï¸ Erro ao carregar dados</h3>
    <!-- Exibe a mensagem de erro armazenada na variÃ¡vel 'erro' -->
    <p>{{ erro }}</p>
    <!-- BotÃ£o para tentar recarregar os dados -->
    <button (click)="recarregar()" class="btn btn-primary">
      Tentar Novamente
    </button>
  </div>

  <!-- ConteÃºdo principal - sÃ³ aparece quando nÃ£o estÃ¡ carregando nem com erro -->
  <div *ngIf="!carregando && !erro" class="conteudo">
    
    <!-- Menu de navegaÃ§Ã£o entre as diferentes visualizaÃ§Ãµes -->
    <nav class="menu-navegacao">
      <!-- BotÃ£o para visualizaÃ§Ã£o em lista -->
      <!-- [class] define a classe CSS dinamicamente baseada na condiÃ§Ã£o -->
      <button
        [class]="visualizacaoAtual === 'lista' ? 'btn btn-primary active' : 'btn btn-secondary'"
        (click)="mudarVisualizacao('lista')"
      >
        ğŸ“‹ Lista de Alimentos
      </button>
      
      <!-- BotÃ£o para visualizaÃ§Ã£o por tipos -->
      <button
        [class]="visualizacaoAtual === 'tipos' ? 'btn btn-primary active' : 'btn btn-secondary'"
        (click)="mudarVisualizacao('tipos')"
      >
        ğŸ·ï¸ Por Tipos
      </button>
      
      <!-- BotÃ£o para visualizaÃ§Ã£o por seÃ§Ãµes -->
      <button
        [class]="visualizacaoAtual === 'secoes' ? 'btn btn-primary active' : 'btn btn-secondary'"
        (click)="mudarVisualizacao('secoes')"
      >
        ğŸ—ºï¸ Por SeÃ§Ãµes
      </button>
      
      <!-- BotÃ£o para visualizaÃ§Ã£o de estatÃ­sticas -->
      <button
        [class]="visualizacaoAtual === 'estatisticas' ? 'btn btn-primary active' : 'btn btn-secondary'"
        (click)="mudarVisualizacao('estatisticas')"
      >
        ğŸ“Š EstatÃ­sticas
      </button>
    </nav>

    <!-- Container dos filtros e pesquisa -->
    <div class="filtros-container">
      <div class="filtros">
        
        <!-- Campo de pesquisa por texto -->
        <div class="campo-filtro">
          <label for="pesquisa">ğŸ” Pesquisar:</label>
          <!-- [(ngModel)] cria two-way binding - sincroniza com termoPesquisa -->
          <!-- (input) executa pesquisar() a cada tecla digitada -->
          <input
            id="pesquisa"
            type="text"
            [(ngModel)]="termoPesquisa"
            (input)="pesquisar()"
            placeholder="Digite o nome do alimento..."
            class="input-pesquisa"
          />
        </div>

        <!-- Filtro por tipo de alimento -->
        <div class="campo-filtro">
          <label for="tipo">ğŸ·ï¸ Filtrar por Tipo:</label>
          <!-- Select com two-way binding e evento de mudanÃ§a -->
          <select
            id="tipo"
            [(ngModel)]="tipoSelecionado"
            (change)="filtrarPorTipo()"
            class="select-filtro"
          >
            <!-- OpÃ§Ã£o padrÃ£o para mostrar todos -->
            <option value="">Todos os tipos</option>
            <!-- *ngFor gera uma option para cada tipo Ãºnico -->
            <option *ngFor="let tipo of tiposUnicos" [value]="tipo">
              {{ tipo }}
            </option>
          </select>
        </div>

        <!-- Filtro por seÃ§Ã£o da horta -->
        <div class="campo-filtro">
          <label for="secao">ğŸ—ºï¸ Filtrar por SeÃ§Ã£o:</label>
          <select
            id="secao"
            [(ngModel)]="secaoSelecionada"
            (change)="filtrarPorSecao()"
            class="select-filtro"
          >
            <option value="">Todas as seÃ§Ãµes</option>
            <!-- *ngFor com funÃ§Ã£o que retorna seÃ§Ãµes Ãºnicas -->
            <option *ngFor="let secao of getSecoesUnicas()" [value]="secao">
              SeÃ§Ã£o {{ secao }}
            </option>
          </select>
        </div>

        <!-- BotÃ£o para limpar todos os filtros -->
        <button (click)="limparFiltros()" class="btn btn-limpar">
          ğŸ—‘ï¸ Limpar Filtros
        </button>
      </div>
    </div>

    <!-- VISUALIZAÃ‡ÃƒO: Lista de Alimentos -->
    <!-- *ngIf mostra apenas quando visualizacaoAtual for 'lista' -->
    <div *ngIf="visualizacaoAtual === 'lista'" class="visualizacao">
      
      <!-- InformaÃ§Ãµes sobre resultados da pesquisa -->
      <div class="info-resultados">
        <p>
          <!-- InterpolaÃ§Ã£o mostra quantidade de alimentos filtrados -->
          <strong>{{ alimentosFiltrados.length }}</strong> alimentos encontrados
        </p>
      </div>

      <!-- Grid responsivo com cards dos alimentos -->
      <div class="grid-alimentos">
        <!-- *ngFor itera sobre alimentos filtrados -->
        <!-- trackBy otimiza a renderizaÃ§Ã£o -->
        <div
          *ngFor="let alimento of alimentosFiltrados; trackBy: trackByNome"
          class="card-alimento"
        >
          <!-- CabeÃ§alho do card com nome e tipo -->
          <div class="card-header">
            <!-- InterpolaÃ§Ã£o exibe o nome do alimento -->
            <h3 class="nome-alimento">{{ alimento.nome_alimento }}</h3>
            <!-- Badge com tipo, usando atributo data para CSS especÃ­fico -->
            <span class="badge-tipo" [attr.data-tipo]="alimento.tipo_alimento"
              >{{ alimento.tipo_alimento }}</span
            >
          </div>
          
          <!-- Corpo do card com informaÃ§Ãµes detalhadas -->
          <div class="card-body">
            <p>
              <strong>Nome CientÃ­fico:</strong>
              <!-- Texto em itÃ¡lico para nome cientÃ­fico -->
              <em>{{ alimento.nome_cientifico }}</em>
            </p>
            <p>
              <strong>SeÃ§Ã£o da Horta:</strong> {{ alimento.secao_circular }}
            </p>
          </div>
        </div>
      </div>

      <!-- Mensagem quando nenhum alimento Ã© encontrado -->
      <div *ngIf="alimentosFiltrados.length === 0" class="mensagem-vazia">
        <h3>ğŸ” Nenhum alimento encontrado</h3>
        <p>Tente ajustar os filtros de pesquisa.</p>
      </div>
    </div>

    <!-- VISUALIZAÃ‡ÃƒO: Por Tipos -->
    <div *ngIf="visualizacaoAtual === 'tipos'" class="visualizacao">
      <h2>ğŸ·ï¸ Alimentos Organizados por Tipo</h2>

      <!-- Loop externo: para cada tipo Ãºnico -->
      <div *ngFor="let tipo of tiposUnicos" class="secao-tipo">
        <!-- CabeÃ§alho da seÃ§Ã£o do tipo -->
        <h3 class="titulo-tipo">{{ tipo }}</h3>
        
        <div class="lista-tipo">
          <!-- Loop interno: para cada alimento -->
          <div *ngFor="let alimento of alimentos" class="item-tipo">
            <!-- *ngIf mostra apenas se o alimento Ã© do tipo atual -->
            <span *ngIf="alimento.tipo_alimento === tipo" class="nome"
              >{{ alimento.nome_alimento }}</span
            >
            <span *ngIf="alimento.tipo_alimento === tipo" class="cientifico"
              >{{ alimento.nome_cientifico }}</span
            >
          </div>
        </div>
      </div>
    </div>

    <!-- VISUALIZAÃ‡ÃƒO: Por SeÃ§Ãµes -->
    <div *ngIf="visualizacaoAtual === 'secoes'" class="visualizacao">
      <h2>ğŸ—ºï¸ DistribuiÃ§Ã£o por SeÃ§Ãµes da Horta</h2>

      <!-- Grid com cards de seÃ§Ãµes -->
      <div class="mapa-secoes">
        <!-- Loop para cada seÃ§Ã£o Ãºnica -->
        <div *ngFor="let secao of getSecoesUnicas()" class="secao-card">
          <h3 class="titulo-secao">SeÃ§Ã£o {{ secao }}</h3>
          
          <div class="alimentos-secao">
            <!-- Loop para todos os alimentos -->
            <div *ngFor="let alimento of alimentos" class="item-secao">
              <!-- Mostra apenas alimentos da seÃ§Ã£o atual -->
              <div
                *ngIf="alimento.secao_circular === secao"
                class="alimento-secao"
              >
                <strong>{{ alimento.nome_alimento }}</strong>
                <!-- Tipo do alimento entre parÃªnteses -->
                <span class="tipo-secao">({{ alimento.tipo_alimento }})</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- VISUALIZAÃ‡ÃƒO: EstatÃ­sticas -->
    <div *ngIf="visualizacaoAtual === 'estatisticas'" class="visualizacao">
      <h2>ğŸ“Š EstatÃ­sticas da Horta</h2>

      <!-- Grid com cards de estatÃ­sticas gerais -->
      <div class="stats-grid">
        
        <!-- Card: Total de alimentos -->
        <div class="stat-card">
          <h3>Total de Alimentos</h3>
          <!-- .length retorna quantidade de itens no array -->
          <div class="stat-numero">{{ alimentos.length }}</div>
        </div>

        <!-- Card: Quantidade de tipos diferentes -->
        <div class="stat-card">
          <h3>Tipos Diferentes</h3>
          <div class="stat-numero">{{ tiposUnicos.length }}</div>
        </div>

        <!-- Card: Quantidade de seÃ§Ãµes ocupadas -->
        <div class="stat-card">
          <h3>SeÃ§Ãµes Ocupadas</h3>
          <div class="stat-numero">{{ getSecoesUnicas().length }}</div>
        </div>
      </div>

      <!-- SeÃ§Ã£o de grÃ¡ficos de barras por tipo -->
      <div class="contagem-tipos">
        <h3>ğŸ“ˆ Quantidade por Tipo</h3>
        
        <div class="barras-container">
          <!-- Loop para cada item de contagem -->
          <div *ngFor="let item of contagemPorTipo" class="barra-item">
            
            <!-- InformaÃ§Ãµes do tipo (nome e quantidade) -->
            <div class="barra-info">
              <span class="barra-tipo">{{ item.tipo_alimento }}</span>
              <span class="barra-numero">{{ item.quantidade }}</span>
            </div>
            
            <!-- Barra visual representando proporÃ§Ã£o -->
            <div class="barra-visual">
              <!-- Barra preenchida com largura proporcional -->
              <!-- [style.width.%] define largura em porcentagem dinamicamente -->
              <div
                class="barra-preenchida"
                [style.width.%]="(item.quantidade / alimentos.length) * 100"
              ></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>